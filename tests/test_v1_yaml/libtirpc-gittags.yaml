schema_version: 1

context:
  name: libtirpc
  version: "1.3.6"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  git: git://linux-nfs.org/~steved/libtirpc
  tag: libtirpc-${{ version | split(".") | join("-") }}

build:
  number: 1
  skip: win
  script:
    - cp $BUILD_PREFIX/share/gnuconfig/config.* .
    - autoreconf --install --force
    - ./configure --help
    # Enable IPV6 constants on macOS
    # c.f. https://krbdev.mit.edu/rt/Ticket/History.html?id=8349
    - if: osx
      then: export CFLAGS="${CFLAGS} -D__APPLE_USE_RFC_3542"
    - ./configure --prefix=${PREFIX} --disable-static --disable-gssapi
    - make --jobs="${CPU_COUNT}"
    - make install

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib("c") }}
    - automake
    - libtool
    - make
    - pkg-config
    - gnuconfig
    # Tools that autotools looks for
    - sed
    - grep
    - gawk

tests:
  - package_contents:
      strict: true
      files:
        - etc/bindresvport.blacklist
        - etc/netconfig
        - etc/conda/test-files/libtirpc/*
        - share/man/man3/*
        - share/man/man5/*
        - lib/pkgconfig/libtirpc.pc
      include:
        - tirpc/netconfig.h
        - tirpc/rpc/auth.h
        - tirpc/rpc/auth_des.h
        - tirpc/rpc/auth_unix.h
        - tirpc/rpc/clnt.h
        - tirpc/rpc/clnt_soc.h
        - tirpc/rpc/clnt_stat.h
        - tirpc/rpc/des.h
        - tirpc/rpc/des_crypt.h
        - tirpc/rpc/key_prot.h
        - tirpc/rpc/nettype.h
        - tirpc/rpc/pmap_clnt.h
        - tirpc/rpc/pmap_prot.h
        - tirpc/rpc/pmap_rmt.h
        - tirpc/rpc/raw.h
        - tirpc/rpc/rpc.h
        - tirpc/rpc/rpc_com.h
        - tirpc/rpc/rpc_msg.h
        - tirpc/rpc/rpcb_clnt.h
        - tirpc/rpc/rpcb_prot.h
        - tirpc/rpc/rpcb_prot.x
        - tirpc/rpc/rpcent.h
        - tirpc/rpc/svc.h
        - tirpc/rpc/svc_auth.h
        - tirpc/rpc/svc_dg.h
        - tirpc/rpc/svc_mt.h
        - tirpc/rpc/svc_soc.h
        - tirpc/rpc/types.h
        - tirpc/rpc/xdr.h
        - tirpc/rpcsvc/crypt.h
        - tirpc/rpcsvc/crypt.x
      lib:
        - tirpc
  - files:
      recipe:
        - test.c
    requirements:
      run:
        - ${{ compiler('c') }}
    script:
      - $CC test.c -o test $CFLAGS -I${CONDA_PREFIX}/include/tirpc $LDFLAGS -ltirpc
      - ./test

about:
  summary: Libtirpc is a Transport-Independent RPC library for Linux
  description: |
    The libtirpc package contains libraries that support programs that use the
    Remote Procedure Call (RPC) API. It replaces the RPC, but not the NIS library
    entries that used to be in glibc.
  license: BSD-3-Clause
  license_file: COPYING
  homepage: http://git.linux-nfs.org/?p=steved/libtirpc.git;a=summary

extra:
  recipe-maintainers:
    - cphyc
